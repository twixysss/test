```markdown
# MMO Auction in Factorio

Мод для **Factorio 1.1**, добавляющий MMO-подобный аукцион между игроками с внутренней валютой, ставками, выкупом и заделом под внешнюю серверную синхронизацию и авторизацию.

Проект рассчитан **в первую очередь на мультиплеер и серверное использование**.

---

## Ключевые возможности

### Аукцион
- Создание аукционов на любые предметы из инвентаря
- Стартовая цена
- Ставки с автоматическим возвратом предыдущей ставки
- Цена мгновенного выкупа (buyout)
- Ограничение по времени
- Корректное завершение аукционов
- Отмена аукциона продавцом (если нет ставок)

### Валюта
- Отдельный баланс для каждого игрока
- Хранение в `global.player_data`
- Проверки на недостаток средств
- Без привязки к предметам Factorio (чисто логическая валюта)

### MMO-архитектура (задел)
- Система авторизации игроков (login / email / password)
- Remote-интерфейсы для:
  - внешнего сервера
  - синхронизации аукционов
  - синхронизации игроков
- Токен-аутентификация для push-синхронизации
- Поддержка снапшотов (полная замена состояния)

---

## Структура мода

```

mmo-auction/
├── auction.lua   # Логика аукциона и экономики
├── auth.lua      # Авторизация игроков (stub + remote API)
├── sync.lua      # Серверная синхронизация (remote interface)
├── control.lua   # Регистрация обработчиков и команд
├── gui.lua       # GUI (если используется)
├── info.json     # Метаданные мода

```

---

## Основные модули

### `auction.lua`
Центральная бизнес-логика.

**Отвечает за:**
- хранение аукционов (`global.auctions`)
- баланс игроков
- работу с инвентарём
- создание, ставки, выкуп, отмену, завершение

**Ключевые функции:**
- `Auction.create(...)`
- `Auction.place_bid(...)`
- `Auction.buyout(...)`
- `Auction.cancel(...)`
- `Auction.finish(...)`
- `Auction.get_balance(player)`
- `Auction.add_balance(player, amount)`

---

### `auth.lua`
Система авторизации игроков.

**Важно:**
- Не хранит пароли
- Не проверяет пароли локально
- Использует **remote interface**
- Предназначена для связки с внешним сервером

**Процесс:**
1. Сервер вызывает `request_login` или `request_register`
2. Игрок вводит пароль через команду
3. Пароль передаётся во внешний sync-сервер
4. Сервер подтверждает или отклоняет авторизацию

**Remote interface:**
```

mmo_auction_auth

```

---

### `sync.lua`
Серверная синхронизация (MMO-ядро).

**Функции:**
- установка токена синхронизации
- приём снапшотов игроков
- приём снапшотов аукционов
- защита от неавторизованных вызовов

**Remote interface:**
```

mmo_auction_sync

````

**Поддерживаемые операции:**
- `set_token(token)`
- `push_snapshot(token, payload)`
- `push_auctions(token, auctions)`
- `push_player(token, player_name, snapshot)`
- `submit_auth(...)` *(stub)*

---

## Хранение данных

### Игрок
```lua
global.player_data[player_index] = {
  balance = number,
  avatar_sprite = string,
  friends = table,
  guild = string | nil,
  auth = {
    status = "authenticated" | "unauthenticated",
    login = string | nil,
    email = string | nil
  }
}
````

### Аукцион

```lua
{
  id = number,
  seller_index = number,
  seller_name = string,
  item_name = string,
  item_count = number,
  start_price = number,
  buyout_price = number | nil,
  highest_bid = number | nil,
  highest_bidder = number | nil,
  ends_at = tick,
  created_at = tick
}
```

---

## Ограничения и честность

* Нет защиты от мультиаккаунтов (ожидается внешний сервер)
* Нет сохранения вне `global` (стандарт Factorio)
* Нет реальной криптографической авторизации
* Buyout и ставки атомарны в рамках тика

---

## Для кого этот мод

* Серверы Factorio с **экономикой**
* MMO-подобные проекты
* Кластеры карт / шардирование
* Интеграция с внешним backend (HTTP / RCON)

---

## Планы расширения (не реализовано)

* Комиссия аукциона
* История сделок
* GUI-аукцион
* Фильтры и поиск
* Реальная серверная авторизация
* Кросс-серверная экономика

---

## Совместимость

* Factorio **1.1**
* Multiplayer: **да**
* Dedicated server: **да**
* Save-safe: **да**

---

## Лицензия

В данный момент не предусмотрена
```
```
